<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Dialogue Editor</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    textarea { width: 100%; height: 150px; }
    .tag { display: inline-block; background: #ddd; padding: 4px 8px; margin: 2px; border-radius: 6px; }
    button { margin: 5px; padding: 6px 12px; }
    .preview { border: 1px solid #ccc; padding: 10px; height: 150px; overflow-y: auto; }
  </style>
</head>
<body>
  <h1>Dialogue Editor</h1>

  <!-- Personajes -->
  <h2>Personajes</h2>
  <input id="charInput" placeholder="Nuevo personaje">
  <button onclick="addCharacter()">Agregar</button>
  <div id="charList"></div>

  <!-- Texto -->
  <h2>Escribir diálogo</h2>
  <textarea id="dialogueInput" placeholder="Ejemplo: Z: Hola mundo"></textarea>

  <!-- Vista previa -->
  <h2>Vista previa</h2>
  <div id="preview" class="preview"></div>

  <!-- Botón exportar -->
  <button onclick="exportJSON()">Exportar JSON</button>

  <script>
    let characters = [];
    let dialogues = [];

    function addCharacter() {
      const input = document.getElementById("charInput");
      const name = input.value.trim();
      if (name && !characters.includes(name)) {
        characters.push(name);
        renderCharacters();
      }
      input.value = "";
    }

    function renderCharacters() {
      const list = document.getElementById("charList");
      list.innerHTML = "";
      characters.forEach(c => {
        const span = document.createElement("span");
        span.className = "tag";
        span.textContent = c;
        list.appendChild(span);
      });
    }

    document.getElementById("dialogueInput").addEventListener("input", (e) => {
      const lines = e.target.value.split("\n").map(line => {
        const [char, ...rest] = line.split(":");
        return {
          character: char?.trim(),
          text: rest.join(":").replace(/""/g, "''").trim()
        };
      }).filter(d => d.character && d.text);

      dialogues = lines;
      renderPreview();
    });

    function renderPreview() {
      const preview = document.getElementById("preview");
      preview.innerHTML = "";
      dialogues.forEach(d => {
        const p = document.createElement("p");
        p.innerHTML = `<b>${d.character}:</b> ${d.text}`;
        preview.appendChild(p);
      });
    }

    function exportJSON() {
      const data = { dialogue: dialogues };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "dialogues.json";
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>